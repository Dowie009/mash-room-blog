# Tech Page 技術ドキュメント

## 概要

`/tech` ページは、Astro + React + GSAPを使用した3Dトンネルエフェクトを持つ技術ブログアーカイブページです。

## バージョン履歴

- **v2.7.0**: ワンちゃんモードのカードサイズ拡大、表示数制限、&more機能追加
- **v2.6.1**: ランダム整列モードでカードが表示されない問題を修正（仮想スクロール無効化）
- **v2.6.0**: 仮想スクロール実装（パフォーマンス最適化）
- **v2.5.x**: カーソルパフォーマンス最適化、ランダム整列モード実装
- **v2.4.x**: カーソル実装、ツールチップ追加
- **v2.3.x**: カテゴリーフィルタリング、カードボーダーアニメーション
- **v2.2.x**: ローディングアニメーション、カテゴリー分散

## 使用技術

### フレームワーク・ライブラリ
- **Astro**: メインフレームワーク（SSG）
- **React**: コンポーネント（Astro統合）
- **GSAP (GreenSock Animation Platform)**: アニメーション
  - `ScrollTrigger`: スクロール連動アニメーション
  - `Flip`: レイアウトアニメーション
- **Content Collections**: 記事管理（Astro）

### 主要機能
1. **3Dトンネルエフェクト**: カードが奥から手前に飛んでくる3Dアニメーション
2. **カテゴリーフィルタリング**: React、CSS、AI、Astro、DevTipsでフィルタリング
3. **ランダム整列モード（ワンちゃんモード）**: カードをグリッド状にランダム配置
4. **カスタムカーソル**: 戦闘機型カーソル（GSAPアニメーション）
5. **ローディングアニメーション**: 背景動画 → フィルター適用 → カード登場

## ファイル構造

```
src/pages/tech.astro  # メインページ（すべてのロジックがここに）
docs/tech-page/       # 技術ドキュメント
  ├── README.md       # このファイル
  ├── ERRORS.md       # エラーと対処法
  └── ARCHITECTURE.md # アーキテクチャ詳細
```

## 主要な変数・関数

### グローバル変数
- `animationFrameId`: 3DトンネルアニメーションのRAF ID
- `cursorRafId`: カーソルアニメーションのRAF ID（独立）
- `isFiltered`: カテゴリーフィルタリング中フラグ
- `isRandomArrange`: ランダム整列モード中フラグ
- `cardElements`: すべてのカード要素の配列

### 主要関数
- `updateTunnel()`: 3Dトンネルアニメーションのメインループ
- `randomArrangeCards()`: ランダム整列モードの実装
- `filterByCategory()`: カテゴリーフィルタリング
- `initTechPage()`: ページ初期化

## パフォーマンス最適化

### 実装済み
1. **SVGボーダーアニメーション停止**: ランダム整列モード時
2. **GPUアクセラレーション**: `force3D: true`, `transformPerspective: 1000`
3. **カーソル独立RAF**: メインアニメーションと分離
4. **表示数制限**: ワンちゃんモードで最大12枚（初期表示）

### 検討中・未実装
- 仮想スクロール（v2.6.0で実装したが、カード表示問題のため無効化）

## カスタマイズポイント

### カードサイズ
- **通常モード**: 260px × 340px
- **ワンちゃんモード**: 400px × 520px（`randomArrangeCards()`内で定義）

### カテゴリーカラー
`categoryColors` オブジェクトで定義（Astroのサーバーサイド）

### アニメーション速度
- カード登場: `duration: 1.5`, `ease: "power3.out"`
- カーソル追従: `duration: 0.1`, `ease: "power2.out"`

## 開発時の注意点

1. **Astroの`define:vars`**: サーバーサイドデータをクライアントに渡す際に使用
2. **GSAPプラグイン登録**: `gsap.registerPlugin(ScrollTrigger, Flip)` を忘れずに
3. **RAF管理**: `animationFrameId`と`cursorRafId`を適切にクリーンアップ
4. **モード切り替え**: `isFiltered`、`isRandomArrange`フラグで状態管理

## 次のステップ

- [ ] 仮想スクロールの再実装（パフォーマンス改善）
- [ ] カードの遅延読み込み（画像最適化）
- [ ] レスポンシブデザインの改善
- [ ] アクセシビリティ対応
