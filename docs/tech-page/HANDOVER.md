# Tech Page 引き継ぎ書

## 🎯 次のセッションで続きをやる場合

### 最初に伝えるべきこと

```
「/tech ページの開発を続けます。docs/tech-page/HANDOVER.md を参照してください。」
```

これだけで、AIは以下の情報を把握できます：
- 現在のバージョン（v2.7.0）
- 実装済み機能
- 現在の状態
- 次のステップ

---

## 📋 現在の状態（v2.7.0）

### 実装済み機能
- ✅ 3Dトンネルエフェクト（カードが奥から手前に飛んでくる）
- ✅ カテゴリーフィルタリング（React、CSS、AI、Astro、DevTips）
- ✅ ランダム整列モード（ワンちゃんモード）
  - カードサイズ: 400px × 520px（大きく見やすく）
  - 最大2列表示
  - 初期表示12枚、&moreボタンで追加読み込み
- ✅ カスタムカーソル（戦闘機型、独立RAFループ）
- ✅ ローディングアニメーション（背景動画 → フィルター → カード登場）
- ✅ カードボーダーアニメーション（SVG、カテゴリー色のグラデーション）
- ✅ ツールチップ（ワンちゃん付近、「見づらい場合は、僕をタップしてね」）

### パフォーマンス最適化
- ✅ カーソルは独立したRAFループ（メインアニメーションと分離）
- ✅ ランダム整列モード時はSVGボーダーアニメーション停止
- ✅ 表示数制限（初期12枚）
- ✅ GPUアクセラレーション（`force3D: true`）

### 既知の問題・制限事項
- ⚠️ 仮想スクロールは実装したが、カード表示問題のため無効化（v2.6.1）
- ⚠️ アーカイブグリッドモードでカーソルFPSが低下する場合がある（要調査）

---

## 📁 重要なファイル

### メインファイル
```
/Users/dowie009/Documents/01　真柴道ゐ/Active/blog/src/pages/tech.astro
```
- すべてのロジックがこの1ファイルに集約されている
- 約2000行のコード

### 技術ドキュメント
```
/Users/dowie009/Documents/01　真柴道ゐ/Active/blog/docs/tech-page/
├── README.md          # 概要、使用技術、主要機能
├── ERRORS.md          # エラーと対処法
├── ARCHITECTURE.md    # アーキテクチャ詳細
└── HANDOVER.md        # このファイル（引き継ぎ書）
```

---

## 🔧 技術スタック

- **Astro**: メインフレームワーク（SSG）
- **React**: コンポーネント（Astro統合）
- **GSAP**: アニメーション（ScrollTrigger, Flip）
- **Content Collections**: 記事管理

---

## 🎨 主要な変数・関数

### グローバル変数
- `animationFrameId`: 3DトンネルアニメーションのRAF ID
- `cursorRafId`: カーソルアニメーションのRAF ID（独立）
- `isFiltered`: カテゴリーフィルタリング中フラグ
- `isRandomArrange`: ランダム整列モード中フラグ
- `cardElements`: すべてのカード要素の配列

### 主要関数
- `updateTunnel()`: 3Dトンネルアニメーションのメインループ
- `randomArrangeCards()`: ランダム整列モードの実装
- `filterByCategory()`: カテゴリーフィルタリング
- `initTechPage()`: ページ初期化

---

## 🚀 次のステップ（TODO）

### 優先度：高
- [ ] 仮想スクロールの再実装（パフォーマンス改善、正しく動作するように）
- [ ] アーカイブグリッドモードでのカーソルFPS改善

### 優先度：中
- [ ] 画像の遅延読み込み（Intersection Observer）
- [ ] レスポンシブデザインの改善
- [ ] 検索機能の追加

### 優先度：低
- [ ] ソート機能（日付、カテゴリー、人気順）
- [ ] お気に入り機能
- [ ] アクセシビリティ対応（ARIA、キーボードナビゲーション）

---

## 💡 開発時の注意点

### 1. バージョン管理
- 変更時は必ずバージョン番号を更新
- 現在のバージョン: **v2.7.0**
- バージョン表示箇所: `tech.astro` の697行目付近

### 2. パフォーマンス
- カーソルは独立したRAFループで動作（`cursorRafId`）
- メインアニメーション（`animationFrameId`）と分離されている
- ランダム整列モード時は3Dアニメーションを停止

### 3. モード管理
- `FREE_FLIGHT`: 通常の3Dトンネルモード
- `FILTERED`: カテゴリーフィルタリング中
- `RANDOM_ARRANGE`: ランダム整列モード（ワンちゃんモード）
- `ARCHIVE_GRID`: アーカイブグリッドモード（リスト表示）

### 4. デバッグ
- `D`キーでデバッグ情報を表示/非表示
- コンソールログ: `[TECH DEBUG]`, `[CATEGORY DEBUG]`, `[CURSOR DEBUG]`
- FPS警告: カーソルFPS < 30の場合に警告

---

## 🐛 よくある問題と対処法

詳細は `ERRORS.md` を参照。主な問題：

1. **カードが表示されない**
   - 原因: 仮想スクロールの実装問題
   - 対処: すべてのカードを表示するように変更（v2.6.1）

2. **カーソルがカクつく**
   - 原因: メインアニメーションと同一RAFループ
   - 対処: 独立したRAFループを作成（v2.5.2）

3. **カテゴリーフィルタリングで他のカードが混ざる**
   - 原因: フィルタリングロジックが不十分
   - 対処: 非表示カードを`z: -5000`に移動（v2.2.8）

---

## 📝 変更履歴（最近）

- **v2.7.0**: ワンちゃんモードのカードサイズ拡大、表示数制限、&more機能追加
- **v2.6.1**: ランダム整列モードでカードが表示されない問題を修正（仮想スクロール無効化）
- **v2.6.0**: 仮想スクロール実装（パフォーマンス最適化、後に無効化）
- **v2.5.x**: カーソルパフォーマンス最適化、ランダム整列モード実装

---

## 🎯 クイックスタート

### 新しい機能を追加する場合
1. `tech.astro` を編集
2. バージョン番号を更新（`v2.7.0` → `v2.8.0`など）
3. 必要に応じて `HANDOVER.md` を更新

### エラーが発生した場合
1. `ERRORS.md` を確認
2. デバッグモード（`D`キー）でFPSなどを確認
3. コンソールログを確認

### パフォーマンス問題が発生した場合
1. カーソルFPSを確認（デバッグモード）
2. 3Dアニメーションが停止されているか確認
3. SVGボーダーアニメーションが停止されているか確認（ランダム整列モード時）

---

## 💬 次のセッションでの会話例

**ユーザー**:
```
「/tech ページの開発を続けます。docs/tech-page/HANDOVER.md を参照してください。」
```

**AI**:
- `HANDOVER.md`を読み込む
- 現在の状態を把握
- 次のステップを提案
- 必要に応じて`README.md`、`ERRORS.md`、`ARCHITECTURE.md`も参照

---

## 📌 重要なポイント

1. **すべてのロジックは1ファイルに集約**: `tech.astro`
2. **バージョン管理**: 変更時は必ずバージョン番号を更新
3. **パフォーマンス**: カーソルは独立したRAFループ
4. **モード管理**: フラグ（`isFiltered`、`isRandomArrange`）で状態管理
5. **デバッグ**: `D`キーでデバッグ情報を表示

---

## 🔗 関連ドキュメント

- **README.md**: 概要、使用技術、主要機能
- **ERRORS.md**: エラーと対処法、デバッグ方法
- **ARCHITECTURE.md**: システム構成、データフロー、アニメーションシステム

---

**最終更新**: 2026年1月12日  
**現在のバージョン**: v2.7.0  
**次のバージョン**: v2.8.0（予定）
